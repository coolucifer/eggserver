exports.ids=[8],exports.modules={109:function(t,e,o){"use strict";o.r(e);var h=o(77),r=o.n(h);for(var n in h)"default"!==n&&function(t){o.d(e,t,(function(){return h[t]}))}(n);e.default=r.a},110:function(t,e,o){(e=o(3)(!1)).push([t.i,".tree-diagram{width:100%;padding:10px;margin:10px 0;min-height:calc(100vh - 100px);background-color:#fff;border-radius:4px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1)}",""]),t.exports=e},120:function(t,e,o){"use strict";o.r(e);class h{constructor(t,e="children"){this.tree=t.concat(),this.childKey=e,this.fontSize=14,this.width=1200,this.height=500,this.canvas=null,this.ctx=null,this.leftNameList=[],this.rightNameList=[],this.leftTree=[],this.rightTree=[],this.columnPositionArr=[]}init(){this.canvas=document.getElementById("canvas"),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.lineWidth=2,this.ctx.font=this.fontSize+"px 微软雅黑",this.depth=this.getDepth(),this.leftNameList=["权限A","权限B"],this.rightNameList=["权限C","权限D"],this.leftTree=new Array(this.depth+1).fill([]),this.rightTree=new Array(this.depth+1).fill([]),this.columnPositionArr=[],this.expandTree(),this.createSideTree(),this.formatNodes()):console.warn("Cannot get canvas")}setCanvas(style={}){const{canvas:canvas,ctx:t,width:e,height:o,fontSize:h}=this;canvas.width=style.width||e,canvas.height=style.height||o,t.lineWidth=style.lineWidth||2,t.font=style.font||h+"px 微软雅黑"}static toCapitalize(t){return t.toLowerCase().replace(/( |^)[a-z]/g,t=>t.toUpperCase())}mapTree(t){const{childKey:e}=this,map=o=>{o.forEach(h=>{t(h,o),h[e]&&map(h[e])})};map(this.tree)}getDepth(){const{childKey:t}=this,e=[],o=(h,r)=>{h.forEach(h=>{h[t]&&h[t].length&&o(h[t],r+1),h.layer=r,e.push(r)})};return o(this.tree,0),console.log("depth: ",Math.max(...e)),Math.max(...e)}expandTree(){const{childKey:t}=this,{leftNameList:e,rightNameList:o}=this;this.tree.forEach(t=>{e.includes(t.name)?t.partOf="left":o.includes(t.name)?t.partOf="right":console.error("ERR_UNSORTED: ",t)});const h=(e,o)=>{e.forEach(e=>{e.partOf||(e.partOf=o.partOf||""),e.layer<this.depth&&(e[t]&&e[t].length||(e[t]=[{name:"",layer:e.layer+1,partOf:e.partOf}]),h(e[t],e))})};h(this.tree)}createSideTree(){const{fontSize:t,height:e,depth:o}=this;this.mapTree(t=>{"left"===t.partOf?this.leftTree[t.layer]=this.leftTree[t.layer].concat(t):"right"===t.partOf&&(this.rightTree[t.layer]=this.rightTree[t.layer].concat(t))}),this.leftTree[o].forEach((t,e)=>{t.total=this.leftTree[o].length,t.index=e}),this.rightTree[o].forEach((t,e)=>{t.total=this.rightTree[o].length,t.index=e});const h=Math.max(this.leftTree[o].length,this.rightTree[o].length)*(t+4);console.log("canvasHeight: ",h),e<h&&(this.setCanvas({height:h}),this.height=h)}formatNodes(){const{ctx:t,depth:e,height:o,childKey:h}=this,r=e=>{const o=Math.ceil(t.measureText(e.name).width+6);0===e.layer?e.width=o+10:e.width=o},n=(t,r)=>{const n=this.columnPositionArr[r];let l=0;if(t.layer===e)l=o/(t.total+1)*(t.index+1);else{const sub=t[h];l=(sub[sub.length-1].position.y+sub[0].position.y)/2}const c={};c.x=n,c.y=l,t.position=c};for(let i=this.depth;i>-1;i--)this.leftTree[i].forEach(t=>{r(t)}),this.rightTree[i].forEach(t=>{r(t)});const l=this.leftTree.map(t=>Math.max(...t.map(t=>t.width))+40),c=this.rightTree.map(t=>Math.max(...t.map(t=>t.width))+40),d=Math.ceil(t.measureText("V服").width+6+20)+40,f=[...l.reverse(),d,...c];let m=0;f.forEach(t=>{m+=t}),this.setCanvas({width:m}),this.width=m,console.log("canvasWidth: ",m),this.columnPositionArr=f.map((t,e)=>{let o=0;for(let i=0;i<e;i++)o+=f[i];return o+=t/2,o});for(let i=this.depth;i>-1;i--)this.leftTree[i].forEach(t=>{n(t,e-t.layer)}),this.rightTree[i].forEach(t=>{n(t,t.layer+this.leftTree.length+1)})}drawLine(t,e,o){const{ctx:h}=this;e.name&&(h.strokeStyle="#000000",h.beginPath(),h.moveTo(Math.floor(t.x),Math.floor(t.y)),h.lineTo(Math.floor(o)||Math.floor((e.x+t.x)/2),Math.floor(t.y)),h.lineTo(Math.floor(o)||Math.floor((e.x+t.x)/2),Math.floor(e.y)),h.lineTo(Math.floor(e.x),Math.floor(e.y)),h.stroke())}render(t="platform"){this.init();const{fontSize:e,ctx:o,depth:r,childKey:n,width:l,height:c}=this;o.clearRect(0,0,l,c);const d=r=>{0===r.layer&&(o.strokeStyle="#000000",o.strokeRect(r.position.x-r.width/2,r.position.y-e/2-3-1,r.width,e+3+3)),r["is"+h.toCapitalize(t)]?o.fillStyle="#f98700":o.fillStyle="#000000",o.fillText(r.name||"",r.position.x,r.position.y),o.fillStyle="#000000"};o.textAlign="center",o.textBaseline="middle";for(let i=r;i>-1;i--)this.leftTree[i].forEach(t=>{d(t),t[n]&&t[n].forEach(e=>{const o=t[n].map(sub=>sub.width),h=Math.max(...o);this.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:e.name,x:e.position.x+e.width/2,y:e.position.y},(e.position.x+h/2+t.position.x-t.width/2)/2)})}),this.rightTree[i].forEach(t=>{d(t),t[n]&&t[n].forEach(e=>{const o=t[n].map(sub=>sub.width),h=Math.max(...o);this.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:e.name,x:e.position.x-e.width/2,y:e.position.y},(e.position.x-h/2+t.position.x+t.width/2)/2)})});(t=>{d(t);const e=Math.max(...t[n].filter(sub=>"left"===sub.partOf).map(sub=>sub.width)),o=Math.max(...t[n].filter(sub=>"right"===sub.partOf).map(sub=>sub.width));t[n].forEach(sub=>{"left"===sub.partOf?this.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x+sub.width/2,y:sub.position.y},(sub.position.x+e/2+t.position.x-t.width/2)/2):this.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x-sub.width/2,y:sub.position.y},(sub.position.x-o/2+t.position.x+t.width/2)/2)})})({name:"root",position:{x:this.columnPositionArr[Math.floor(this.columnPositionArr.length/2)],y:this.height/2},layer:0,width:Math.ceil(o.measureText("root").width+6+20),children:[...this.leftTree[0],...this.rightTree[0]]})}changeRole(t,e){const{ctx:o,depth:r,fontSize:n}=this,l=e=>{o.clearRect(e.position.x-e.width/2,e.position.y-n/2-3-1,e.width,n+3+3),0===e.layer&&(o.strokeStyle="#000000",o.strokeRect(e.position.x-e.width/2,e.position.y-n/2-3-1,e.width,n+3+3)),e["is"+h.toCapitalize(t)]?o.fillStyle="#f98700":o.fillStyle="#000000",o.fillText(e.name||"",e.position.x,e.position.y),o.fillStyle="#000000"};for(let i=r;i>-1;i--)this.leftTree[i].forEach(o=>{o["is"+h.toCapitalize(t)]!==o["is"+h.toCapitalize(e)]&&l(o)}),this.rightTree[i].forEach(o=>{o["is"+h.toCapitalize(t)]!==o["is"+h.toCapitalize(e)]&&l(o)})}}var r=h,n={components:{},data:()=>({tree:null,selectedRole:"platform",treeData:[{name:"权限A",isPlatform:!0,children:[{name:"权限a",isShop:!0}]},{name:"权限B",isPlatform:!0,isOperator:!0,children:[{name:"权限b",isShop:!0,children:[{name:"b子权限",isOperator:!0}]}]},{name:"权限C",isPlatform:!0,isOperator:!0,children:[{name:"权限c1",isShop:!0},{name:"权限c2",isPlatform:!0}]},{name:"权限D",isOperator:!0,children:[{name:"权限d1",isShop:!0,children:[{name:"d子权限",isPlatform:!0}]},{name:"权限d2",isPlatform:!0}]}]}),computed:{},watch:{selectedRole(t,e){this.tree.changeRole(t,e)}},created(){},mounted(){this.tree=new r(this.treeData),this.tree.render()},methods:{}},l=o(1);var component=Object(l.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"tree-diagram"},[t._ssrNode("<h1>Canvas绘制树形图</h1> "),t._ssrNode("<div>","</div>",[o("el-radio-group",{model:{value:t.selectedRole,callback:function(e){t.selectedRole=e},expression:"selectedRole"}},[o("el-radio",{attrs:{label:"platform"}},[t._v("\n        platform\n      ")]),t._v(" "),o("el-radio",{attrs:{label:"operator"}},[t._v("\n        operator\n      ")]),t._v(" "),o("el-radio",{attrs:{label:"shop"}},[t._v("\n        shop\n      ")])],1)],1),t._ssrNode(' <canvas id="canvas"></canvas>')],2)}),[],!1,(function(t){var e=o(109);e.__inject__&&e.__inject__(t)}),null,"48f00ceb");e.default=component.exports},77:function(t,e,o){var content=o(110);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var h=o(4).default;t.exports.__inject__=function(t){h("d3685572",content,!0,t)}}};