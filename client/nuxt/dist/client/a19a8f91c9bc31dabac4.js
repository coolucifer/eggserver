(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1130:function(t,e,n){"use strict";n.r(e);n(73);var o=n(145);var r=n(169);function h(t){return function(t){if(Array.isArray(t))return Object(o.a)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(r.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n(26),n(75),n(104),n(442);var l=n(121),c=n(122),f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"children";Object(l.a)(this,t),this.tree=e.concat(),this.childKey=n,this.fontSize=14,this.width=1200,this.height=500,this.canvas=null,this.ctx=null,this.leftNameList=[],this.rightNameList=[],this.leftTree=[],this.rightTree=[],this.columnPositionArr=[]}return Object(c.a)(t,[{key:"init",value:function(){this.canvas=document.getElementById("canvas"),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.lineWidth=2,this.ctx.font="".concat(this.fontSize,"px 微软雅黑"),this.depth=this.getDepth(),this.leftNameList=["权限A","权限B"],this.rightNameList=["权限C","权限D"],this.leftTree=new Array(this.depth+1).fill([]),this.rightTree=new Array(this.depth+1).fill([]),this.columnPositionArr=[],this.expandTree(),this.createSideTree(),this.formatNodes()):console.warn("Cannot get canvas")}},{key:"setCanvas",value:function(){var style=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},canvas=this.canvas,t=this.ctx,e=this.width,n=this.height,o=this.fontSize;canvas.width=style.width||e,canvas.height=style.height||n,t.lineWidth=style.lineWidth||2,t.font=style.font||"".concat(o,"px 微软雅黑")}},{key:"mapTree",value:function(t){var e=this.childKey;!function map(n){n.forEach((function(o){t(o,n),o[e]&&map(o[e])}))}(this.tree)}},{key:"getDepth",value:function(){var t=this.childKey,e=[],n=function n(o,r){o.forEach((function(o){o[t]&&o[t].length&&n(o[t],r+1),o.layer=r,e.push(r)}))};return n(this.tree,0),console.log("depth: ",Math.max.apply(Math,e)),Math.max.apply(Math,e)}},{key:"expandTree",value:function(){var t=this,e=this.childKey,n=this.leftNameList,o=this.rightNameList;this.tree.forEach((function(t){n.includes(t.name)?t.partOf="left":o.includes(t.name)?t.partOf="right":console.error("ERR_UNSORTED: ",t)}));!function n(o,r){o.forEach((function(o){o.partOf||(o.partOf=r.partOf||""),o.layer<t.depth&&(o[e]&&o[e].length||(o[e]=[{name:"",layer:o.layer+1,partOf:o.partOf}]),n(o[e],o))}))}(this.tree)}},{key:"createSideTree",value:function(){var t=this,e=this.fontSize,n=this.height,o=this.depth;this.mapTree((function(e){"left"===e.partOf?t.leftTree[e.layer]=t.leftTree[e.layer].concat(e):"right"===e.partOf&&(t.rightTree[e.layer]=t.rightTree[e.layer].concat(e))})),this.leftTree[o].forEach((function(e,n){e.total=t.leftTree[o].length,e.index=n})),this.rightTree[o].forEach((function(e,n){e.total=t.rightTree[o].length,e.index=n}));var r=Math.max.apply(Math,[this.leftTree[o].length,this.rightTree[o].length])*(e+4);console.log("canvasHeight: ",r),n<r&&(this.setCanvas({height:r}),this.height=r)}},{key:"formatNodes",value:function(){for(var t=this,e=this.ctx,n=this.depth,o=this.height,r=this.childKey,l=function(t){var n=Math.ceil(e.measureText(t.name).width+6);0===t.layer?t.width=n+10:t.width=n},c=function(e,h){var l=t.columnPositionArr[h],c=0;if(e.layer===n)c=o/(e.total+1)*(e.index+1);else{var sub=e[r];c=(sub[sub.length-1].position.y+sub[0].position.y)/2}var f={};f.x=l,f.y=c,e.position=f},i=this.depth;i>-1;i--)this.leftTree[i].forEach((function(t){l(t)})),this.rightTree[i].forEach((function(t){l(t)}));var f=this.leftTree.map((function(t){return Math.max.apply(Math,h(t.map((function(t){return t.width}))))+40})),d=this.rightTree.map((function(t){return Math.max.apply(Math,h(t.map((function(t){return t.width}))))+40})),m=Math.ceil(e.measureText("V服").width+6+20)+40,y=[].concat(h(f.reverse()),[m],h(d)),x=0;y.forEach((function(t){x+=t})),this.setCanvas({width:x}),this.width=x,console.log("canvasWidth: ",x),this.columnPositionArr=y.map((function(t,e){for(var n=0,o=0;o<e;o++)n+=y[o];return n+=t/2}));for(var v=this.depth;v>-1;v--)this.leftTree[v].forEach((function(t){c(t,n-t.layer)})),this.rightTree[v].forEach((function(e){c(e,e.layer+t.leftTree.length+1)}))}},{key:"drawLine",value:function(t,e,n){var o=this.ctx;e.name&&(o.strokeStyle="#000000",o.beginPath(),o.moveTo(Math.floor(t.x),Math.floor(t.y)),o.lineTo(Math.floor(n)||Math.floor((e.x+t.x)/2),Math.floor(t.y)),o.lineTo(Math.floor(n)||Math.floor((e.x+t.x)/2),Math.floor(e.y)),o.lineTo(Math.floor(e.x),Math.floor(e.y)),o.stroke())}},{key:"render",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"platform";this.init();var o=this.fontSize,r=this.ctx,l=this.depth,c=this.childKey,f=this.width,d=this.height;r.clearRect(0,0,f,d);var m=function(e){0===e.layer&&(r.strokeStyle="#000000",r.strokeRect(e.position.x-e.width/2,e.position.y-o/2-3-1,e.width,o+3+3)),e["is".concat(t.toCapitalize(n))]?r.fillStyle="#f98700":r.fillStyle="#000000",r.fillText(e.name||"",e.position.x,e.position.y),r.fillStyle="#000000"};r.textAlign="center",r.textBaseline="middle";for(var i=l;i>-1;i--)this.leftTree[i].forEach((function(t){m(t),t[c]&&t[c].forEach((function(n){var o=t[c].map((function(sub){return sub.width})),r=Math.max.apply(Math,h(o));e.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:n.name,x:n.position.x+n.width/2,y:n.position.y},(n.position.x+r/2+t.position.x-t.width/2)/2)}))})),this.rightTree[i].forEach((function(t){m(t),t[c]&&t[c].forEach((function(n){var o=t[c].map((function(sub){return sub.width})),r=Math.max.apply(Math,h(o));e.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:n.name,x:n.position.x-n.width/2,y:n.position.y},(n.position.x-r/2+t.position.x+t.width/2)/2)}))}));var y={name:"root",position:{x:this.columnPositionArr[Math.floor(this.columnPositionArr.length/2)],y:this.height/2},layer:0,width:Math.ceil(r.measureText("root").width+6+20),children:[].concat(h(this.leftTree[0]),h(this.rightTree[0]))},x=function(t){m(t);var n=Math.max.apply(Math,h(t[c].filter((function(sub){return"left"===sub.partOf})).map((function(sub){return sub.width})))),o=Math.max.apply(Math,h(t[c].filter((function(sub){return"right"===sub.partOf})).map((function(sub){return sub.width}))));t[c].forEach((function(sub){"left"===sub.partOf?e.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x+sub.width/2,y:sub.position.y},(sub.position.x+n/2+t.position.x-t.width/2)/2):e.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x-sub.width/2,y:sub.position.y},(sub.position.x-o/2+t.position.x+t.width/2)/2)}))};x(y)}},{key:"changeRole",value:function(e,n){for(var o=this.ctx,r=this.depth,h=this.fontSize,l=function(n){o.clearRect(n.position.x-n.width/2,n.position.y-h/2-3-1,n.width,h+3+3),0===n.layer&&(o.strokeStyle="#000000",o.strokeRect(n.position.x-n.width/2,n.position.y-h/2-3-1,n.width,h+3+3)),n["is".concat(t.toCapitalize(e))]?o.fillStyle="#f98700":o.fillStyle="#000000",o.fillText(n.name||"",n.position.x,n.position.y),o.fillStyle="#000000"},i=r;i>-1;i--)this.leftTree[i].forEach((function(o){o["is".concat(t.toCapitalize(e))]!==o["is".concat(t.toCapitalize(n))]&&l(o)})),this.rightTree[i].forEach((function(o){o["is".concat(t.toCapitalize(e))]!==o["is".concat(t.toCapitalize(n))]&&l(o)}))}}],[{key:"toCapitalize",value:function(t){return t.toLowerCase().replace(/( |^)[a-z]/g,(function(t){return t.toUpperCase()}))}}]),t}(),d={components:{},data:function(){return{tree:null,selectedRole:"platform",treeData:[{name:"权限A",isPlatform:!0,children:[{name:"权限a",isShop:!0}]},{name:"权限B",isPlatform:!0,isOperator:!0,children:[{name:"权限b",isShop:!0,children:[{name:"b子权限",isOperator:!0}]}]},{name:"权限C",isPlatform:!0,isOperator:!0,children:[{name:"权限c1",isShop:!0},{name:"权限c2",isPlatform:!0}]},{name:"权限D",isOperator:!0,children:[{name:"权限d1",isShop:!0,children:[{name:"d子权限",isPlatform:!0}]},{name:"权限d2",isPlatform:!0}]}]}},computed:{},watch:{selectedRole:function(t,e){this.tree.changeRole(t,e)}},created:function(){},mounted:function(){this.tree=new f(this.treeData),this.tree.render()},methods:{}},m=(n(631),n(12)),component=Object(m.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tree-diagram"},[n("h1",[t._v("Canvas绘制树形图")]),t._v(" "),n("div",[n("el-radio-group",{model:{value:t.selectedRole,callback:function(e){t.selectedRole=e},expression:"selectedRole"}},[n("el-radio",{attrs:{label:"platform"}},[t._v("\n        platform\n      ")]),t._v(" "),n("el-radio",{attrs:{label:"operator"}},[t._v("\n        operator\n      ")]),t._v(" "),n("el-radio",{attrs:{label:"shop"}},[t._v("\n        shop\n      ")])],1)],1),t._v(" "),n("canvas",{attrs:{id:"canvas"}})])}),[],!1,null,null,null);e.default=component.exports},442:function(t,e,n){var o=n(4);o(o.P,"Array",{fill:n(150)}),n(103)("fill")},452:function(t,e,n){var content=n(632);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(25).default)("d3685572",content,!0,{sourceMap:!1})},631:function(t,e,n){"use strict";var o=n(452);n.n(o).a},632:function(t,e,n){(e=n(24)(!1)).push([t.i,".tree-diagram{width:100%;padding:10px;margin:10px 0;min-height:calc(100vh - 100px);background-color:#fff;border-radius:4px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1)}",""]),t.exports=e}}]);