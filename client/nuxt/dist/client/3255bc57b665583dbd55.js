(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{330:function(t,e,n){var o=n(5);o(o.P,"Array",{fill:n(331)}),n(126)("fill")},331:function(t,e,n){"use strict";var o=n(42),r=n(182),h=n(33);t.exports=function(t){for(var e=o(this),n=h(e.length),l=arguments.length,c=r(l>1?arguments[1]:void 0,n),f=l>2?arguments[2]:void 0,d=void 0===f?n:r(f,n);d>c;)e[c++]=t;return e}},332:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return o}))},333:function(t,e,n){"use strict";function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}n.d(e,"a",(function(){return r}))},343:function(t,e,n){var content=n(403);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(22).default)("d3685572",content,!0,{sourceMap:!1})},402:function(t,e,n){"use strict";var o=n(343);n.n(o).a},403:function(t,e,n){var o=n(21);(t.exports=o(!1)).push([t.i,".tree-diagram{width:100%;padding:10px;margin:10px 0;min-height:calc(100vh - 100px);background-color:#fff;border-radius:4px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1)}",""])},599:function(t,e,n){"use strict";n.r(e);n(56);function o(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n(89),n(87),n(129),n(330);var r=n(332),h=n(333),l=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"children";Object(r.a)(this,t),this.tree=e.concat(),this.childKey=n,this.fontSize=14,this.width=1200,this.height=500,this.canvas=null,this.ctx=null,this.leftNameList=[],this.rightNameList=[],this.leftTree=[],this.rightTree=[],this.columnPositionArr=[]}return Object(h.a)(t,[{key:"init",value:function(){this.canvas=document.getElementById("canvas"),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.lineWidth=2,this.ctx.font="".concat(this.fontSize,"px 微软雅黑"),this.depth=this.getDepth(),this.leftNameList=["权限A","权限B"],this.rightNameList=["权限C","权限D"],this.leftTree=new Array(this.depth+1).fill([]),this.rightTree=new Array(this.depth+1).fill([]),this.columnPositionArr=[],this.expandTree(),this.createSideTree(),this.formatNodes()):console.warn("Cannot get canvas")}},{key:"setCanvas",value:function(){var style=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},canvas=this.canvas,t=this.ctx,e=this.width,n=this.height,o=this.fontSize;canvas.width=style.width||e,canvas.height=style.height||n,t.lineWidth=style.lineWidth||2,t.font=style.font||"".concat(o,"px 微软雅黑")}},{key:"mapTree",value:function(t){var e=this.childKey;!function map(n){n.forEach((function(o){t(o,n),o[e]&&map(o[e])}))}(this.tree)}},{key:"getDepth",value:function(){var t=this.childKey,e=[],n=function n(o,r){o.forEach((function(o){o[t]&&o[t].length&&n(o[t],r+1),o.layer=r,e.push(r)}))};return n(this.tree,0),console.log("depth: ",Math.max.apply(Math,e)),Math.max.apply(Math,e)}},{key:"expandTree",value:function(){var t=this,e=this.childKey,n=this.leftNameList,o=this.rightNameList;this.tree.forEach((function(t){n.includes(t.name)?t.partOf="left":o.includes(t.name)?t.partOf="right":console.error("ERR_UNSORTED: ",t)}));!function n(o,r){o.forEach((function(o){o.partOf||(o.partOf=r.partOf||""),o.layer<t.depth&&(o[e]&&o[e].length||(o[e]=[{name:"",layer:o.layer+1,partOf:o.partOf}]),n(o[e],o))}))}(this.tree)}},{key:"createSideTree",value:function(){var t=this,e=this.fontSize,n=this.height,o=this.depth;this.mapTree((function(e){"left"===e.partOf?t.leftTree[e.layer]=t.leftTree[e.layer].concat(e):"right"===e.partOf&&(t.rightTree[e.layer]=t.rightTree[e.layer].concat(e))})),this.leftTree[o].forEach((function(e,n){e.total=t.leftTree[o].length,e.index=n})),this.rightTree[o].forEach((function(e,n){e.total=t.rightTree[o].length,e.index=n}));var r=Math.max.apply(Math,[this.leftTree[o].length,this.rightTree[o].length])*(e+4);console.log("canvasHeight: ",r),n<r&&(this.setCanvas({height:r}),this.height=r)}},{key:"formatNodes",value:function(){for(var t=this,e=this.ctx,n=this.depth,r=this.height,h=this.childKey,l=function(t){var n=Math.ceil(e.measureText(t.name).width+6);0===t.layer?t.width=n+10:t.width=n},c=function(e,o){var l=t.columnPositionArr[o],c=0;if(e.layer===n)c=r/(e.total+1)*(e.index+1);else{var sub=e[h];c=(sub[sub.length-1].position.y+sub[0].position.y)/2}var f={};f.x=l,f.y=c,e.position=f},i=this.depth;i>-1;i--)this.leftTree[i].forEach((function(t){l(t)})),this.rightTree[i].forEach((function(t){l(t)}));var f=this.leftTree.map((function(t){return Math.max.apply(Math,o(t.map((function(t){return t.width}))))+40})),d=this.rightTree.map((function(t){return Math.max.apply(Math,o(t.map((function(t){return t.width}))))+40})),m=Math.ceil(e.measureText("V服").width+6+20)+40,y=[].concat(o(f.reverse()),[m],o(d)),v=0;y.forEach((function(t){v+=t})),this.setCanvas({width:v}),this.width=v,console.log("canvasWidth: ",v),this.columnPositionArr=y.map((function(t,e){for(var n=0,o=0;o<e;o++)n+=y[o];return n+=t/2}));for(var x=this.depth;x>-1;x--)this.leftTree[x].forEach((function(t){c(t,n-t.layer)})),this.rightTree[x].forEach((function(e){c(e,e.layer+t.leftTree.length+1)}))}},{key:"drawLine",value:function(t,e,n){var o=this.ctx;e.name&&(o.strokeStyle="#000000",o.beginPath(),o.moveTo(Math.floor(t.x),Math.floor(t.y)),o.lineTo(Math.floor(n)||Math.floor((e.x+t.x)/2),Math.floor(t.y)),o.lineTo(Math.floor(n)||Math.floor((e.x+t.x)/2),Math.floor(e.y)),o.lineTo(Math.floor(e.x),Math.floor(e.y)),o.stroke())}},{key:"render",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"platform";this.init();var r=this.fontSize,h=this.ctx,l=this.depth,c=this.childKey,f=this.width,d=this.height;h.clearRect(0,0,f,d);var m=function(e){0===e.layer&&(h.strokeStyle="#000000",h.strokeRect(e.position.x-e.width/2,e.position.y-r/2-3-1,e.width,r+3+3)),e["is".concat(t.toCapitalize(n))]?h.fillStyle="#f98700":h.fillStyle="#000000",h.fillText(e.name||"",e.position.x,e.position.y),h.fillStyle="#000000"};h.textAlign="center",h.textBaseline="middle";for(var i=l;i>-1;i--)this.leftTree[i].forEach((function(t){m(t),t[c]&&t[c].forEach((function(n){var r=t[c].map((function(sub){return sub.width})),h=Math.max.apply(Math,o(r));e.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:n.name,x:n.position.x+n.width/2,y:n.position.y},(n.position.x+h/2+t.position.x-t.width/2)/2)}))})),this.rightTree[i].forEach((function(t){m(t),t[c]&&t[c].forEach((function(n){var r=t[c].map((function(sub){return sub.width})),h=Math.max.apply(Math,o(r));e.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:n.name,x:n.position.x-n.width/2,y:n.position.y},(n.position.x-h/2+t.position.x+t.width/2)/2)}))}));var y={name:"root",position:{x:this.columnPositionArr[Math.floor(this.columnPositionArr.length/2)],y:this.height/2},layer:0,width:Math.ceil(h.measureText("root").width+6+20),children:[].concat(o(this.leftTree[0]),o(this.rightTree[0]))},v=function(t){m(t);var n=Math.max.apply(Math,o(t[c].filter((function(sub){return"left"===sub.partOf})).map((function(sub){return sub.width})))),r=Math.max.apply(Math,o(t[c].filter((function(sub){return"right"===sub.partOf})).map((function(sub){return sub.width}))));t[c].forEach((function(sub){"left"===sub.partOf?e.drawLine({name:t.name,x:t.position.x-t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x+sub.width/2,y:sub.position.y},(sub.position.x+n/2+t.position.x-t.width/2)/2):e.drawLine({name:t.name,x:t.position.x+t.width/2,y:t.position.y},{name:sub.name,x:sub.position.x-sub.width/2,y:sub.position.y},(sub.position.x-r/2+t.position.x+t.width/2)/2)}))};v(y)}},{key:"changeRole",value:function(e,n){for(var o=this.ctx,r=this.depth,h=this.fontSize,l=function(n){o.clearRect(n.position.x-n.width/2,n.position.y-h/2-3-1,n.width,h+3+3),0===n.layer&&(o.strokeStyle="#000000",o.strokeRect(n.position.x-n.width/2,n.position.y-h/2-3-1,n.width,h+3+3)),n["is".concat(t.toCapitalize(e))]?o.fillStyle="#f98700":o.fillStyle="#000000",o.fillText(n.name||"",n.position.x,n.position.y),o.fillStyle="#000000"},i=r;i>-1;i--)this.leftTree[i].forEach((function(o){o["is".concat(t.toCapitalize(e))]!==o["is".concat(t.toCapitalize(n))]&&l(o)})),this.rightTree[i].forEach((function(o){o["is".concat(t.toCapitalize(e))]!==o["is".concat(t.toCapitalize(n))]&&l(o)}))}}],[{key:"toCapitalize",value:function(t){return t.toLowerCase().replace(/( |^)[a-z]/g,(function(t){return t.toUpperCase()}))}}]),t}(),c={layout:"blog",components:{},data:function(){return{tree:null,selectedRole:"platform",treeData:[{name:"权限A",isPlatform:!0,children:[{name:"权限a",isShop:!0}]},{name:"权限B",isPlatform:!0,isOperator:!0,children:[{name:"权限b",isShop:!0,children:[{name:"b子权限",isOperator:!0}]}]},{name:"权限C",isPlatform:!0,isOperator:!0,children:[{name:"权限c1",isShop:!0},{name:"权限c2",isPlatform:!0}]},{name:"权限D",isOperator:!0,children:[{name:"权限d1",isShop:!0,children:[{name:"d子权限",isPlatform:!0}]},{name:"权限d2",isPlatform:!0}]}]}},computed:{},watch:{selectedRole:function(t,e){this.tree.changeRole(t,e)}},created:function(){},mounted:function(){this.tree=new l(this.treeData),this.tree.render()},methods:{}},f=(n(402),n(8)),component=Object(f.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tree-diagram"},[n("h1",[t._v("Canvas绘制树形图")]),t._v(" "),n("div",[n("el-radio-group",{model:{value:t.selectedRole,callback:function(e){t.selectedRole=e},expression:"selectedRole"}},[n("el-radio",{attrs:{label:"platform"}},[t._v("\n        platform\n      ")]),t._v(" "),n("el-radio",{attrs:{label:"operator"}},[t._v("\n        operator\n      ")]),t._v(" "),n("el-radio",{attrs:{label:"shop"}},[t._v("\n        shop\n      ")])],1)],1),t._v(" "),n("canvas",{attrs:{id:"canvas"}})])}),[],!1,null,null,null);e.default=component.exports}}]);